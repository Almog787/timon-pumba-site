<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pumbaa Hit: ×”××¢×•×£ ×”××—×¨×•×Ÿ | ×˜×™××•×Ÿ ×•×¤×•××‘×”</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ—</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; touch-action: none; }
        body { 
            font-family: 'Rubik', sans-serif; 
            background-color: #050505; 
            color: white; 
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* UI Layer */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }

        .stats {
            position: absolute; top: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between;
            font-size: 1.5rem; font-weight: 900; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* Power Meter */
        #power-meter {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            width: 260px; background: rgba(0,0,0,0.7); padding: 20px;
            border-radius: 20px; border: 2px solid #444; pointer-events: auto;
            text-align: center;
        }
        .meter-bar { width: 100%; height: 20px; background: #222; border-radius: 10px; overflow: hidden; margin-top: 10px; border: 1px solid #fff; }
        #meter-fill { width: 0%; height: 100%; background: linear-gradient(to right, #25D366, #ffb900, #ff4b4b); }

        /* Screens */
        .screen {
            position: absolute; inset: 0; background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; text-align: center; backdrop-filter: blur(10px); pointer-events: auto;
        }

        .btn {
            padding: 16px 45px; border-radius: 50px; border: none;
            background: #ffb900; color: #000; font-weight: 900;
            font-size: 1.3rem; cursor: pointer; transition: 0.3s; margin-top: 20px;
        }
        .btn:hover { transform: scale(1.1); box-shadow: 0 0 20px #ffb900; }

        canvas { display: block; width: 100%; height: 100%; }
        
        .hint { position: absolute; bottom: 20px; width: 100%; text-align: center; color: #666; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stats">
            <div>××¨×—×§: <span id="dist-ui" style="color:#ffb900">0</span> ×'</div>
            <div style="font-size: 1rem; color: #888;">×©×™×: <span id="best-ui">0</span> ×'</div>
        </div>

        <div id="power-meter">
            <div style="font-weight: 900; font-size: 1.1rem;">×¢×•×¦××ª ×—×‘×˜×”</div>
            <div class="meter-bar"><div id="meter-fill"></div></div>
        </div>

        <div id="game-over" class="screen" style="display: none;">
            <h1 style="font-size: 3.5rem; color: #ffb900; margin-bottom: 10px;">× ×—×™×ª×”! ğŸ§</h1>
            <p id="final-score" style="font-size: 1.5rem; margin-bottom: 30px;"></p>
            <button class="btn" onclick="resetGame()">×—×‘×˜×” × ×•×¡×¤×ª ğŸ—</button>
            <a href="../" style="margin-top: 20px; color: #555; text-decoration: none; font-weight: bold; display: block;">×—×–×¨×” ×œ××ª×¨</a>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>
    <div class="hint">×‘××•×•×™×¨: ×œ×—×™×¦×” ×œ-SLAM ××”×™×¨ âš¡ | ×¤×’×¢ ×‘-ğŸ¦­, ğŸš€, â˜ï¸</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Game State
    let state = 'START'; // START, POWER, FLYING, ENDED
    let width, height, cameraX = 0, score = 0, shake = 0;
    let power = 0, powerDir = 1;
    let highScore = localStorage.getItem('pumbaaHitBest') || 0;
    document.getElementById('best-ui').innerText = highScore;

    // Physics Constants
    const GRAVITY = 0.25;
    const FRICTION = 0.995;
    const GROUND_Y = 60;

    const penguin = {
        x: 100, y: 0, vx: 0, vy: 0, rot: 0,
        isSlamming: false, trail: []
    };

    let objects = [];
    let particles = [];

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        penguin.y = height - GROUND_Y - 30;
    }

    function spawnObjects(startX) {
        const types = ['SEAL', 'CLOUD', 'ROCKET', 'BIRD', 'TRAMPOLINE'];
        for (let i = 0; i < 10; i++) {
            const type = types[Math.floor(Math.random() * types.length)];
            objects.push({
                x: startX + (i * 500) + Math.random() * 300,
                y: (type === 'SEAL' || type === 'TRAMPOLINE') ? height - GROUND_Y - 20 : 100 + Math.random() * (height - 300),
                type: type,
                active: true,
                emoji: { SEAL:'ğŸ¦­', CLOUD:'â˜ï¸', ROCKET:'ğŸš€', BIRD:'ğŸ¦…', TRAMPOLINE:'ğŸª' }[type]
            });
        }
    }

    function resetGame() {
        state = 'POWER';
        cameraX = 0; score = 0; power = 0;
        penguin.x = 100; penguin.y = height - GROUND_Y - 30;
        penguin.vx = 0; penguin.vy = 0; penguin.rot = 0;
        penguin.isSlamming = false; penguin.trail = [];
        objects = []; particles = [];
        spawnObjects(800);
        document.getElementById('game-over').style.display = 'none';
        document.getElementById('power-meter').style.display = 'block';
    }

    function handleInput() {
        if (state === 'POWER') {
            const p = power / 100;
            penguin.vx = 15 + (p * 35);
            penguin.vy = -10 - (p * 25);
            state = 'FLYING';
            document.getElementById('power-meter').style.display = 'none';
            shake = 15;
        } else if (state === 'FLYING' && !penguin.isSlamming) {
            penguin.vy = 25;
            penguin.isSlamming = true;
        }
    }

    function update() {
        if (state === 'POWER') {
            power += 4 * powerDir;
            if (power > 100 || power < 0) powerDir *= -1;
            document.getElementById('meter-fill').style.width = power + '%';
        }

        if (state === 'FLYING') {
            penguin.vy += GRAVITY;
            penguin.vx *= FRICTION;
            penguin.x += penguin.vx;
            penguin.y += penguin.vy;
            penguin.rot += penguin.vx * 0.01;

            penguin.trail.push({x: penguin.x, y: penguin.y});
            if (penguin.trail.length > 15) penguin.trail.shift();

            cameraX = penguin.x - 150;

            // Ground Collision
            if (penguin.y > height - GROUND_Y - 20) {
                penguin.y = height - GROUND_Y - 20;
                penguin.vy *= -0.4;
                penguin.vx *= 0.8;
                penguin.isSlamming = false;
                if (penguin.vx < 0.5) {
                    state = 'ENDED';
                    showGameOver();
                }
            }

            // Object Collision
            objects.forEach(obj => {
                if (!obj.active) return;
                const dx = penguin.x - obj.x;
                const dy = penguin.y - obj.y;
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < 50) {
                    obj.active = false;
                    shake = 10;
                    if (obj.type === 'SEAL') { penguin.vy = -20; penguin.vx += 5; }
                    if (obj.type === 'TRAMPOLINE') { penguin.vy = -30; }
                    if (obj.type === 'CLOUD') { penguin.vx += 10; penguin.vy -= 5; }
                    if (obj.type === 'ROCKET') { penguin.vx += 40; penguin.vy = -2; }
                    if (obj.type === 'BIRD') { penguin.vx *= 0.5; }
                    penguin.isSlamming = false;
                }
            });

            if (penguin.x > objects[objects.length - 5].x) spawnObjects(objects[objects.length - 1].x + 500);
            document.getElementById('dist-ui').innerText = Math.floor(penguin.x / 10);
        }
    }

    function draw() {
        ctx.save();
        if (shake > 0) {
            ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
            shake *= 0.9;
        }
        
        // Background
        const grad = ctx.createLinearGradient(0, 0, 0, height);
        grad.addColorStop(0, '#001d3d');
        grad.addColorStop(1, '#003566');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, width, height);

        // Ground
        ctx.fillStyle = '#000814';
        ctx.fillRect(0, height - GROUND_Y, width, GROUND_Y);
        ctx.strokeStyle = '#ffb900';
        ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(0, height-GROUND_Y); ctx.lineTo(width, height-GROUND_Y); ctx.stroke();

        // Objects
        objects.forEach(obj => {
            const sx = obj.x - cameraX;
            if (sx > -100 && sx < width + 100) {
                ctx.font = '50px serif';
                ctx.globalAlpha = obj.active ? 1 : 0.1;
                ctx.fillText(obj.emoji, sx - 25, obj.y + 20);
            }
        });
        ctx.globalAlpha = 1;

        // Trail
        if (penguin.trail.length > 1) {
            ctx.beginPath();
            ctx.strokeStyle = penguin.isSlamming ? '#ff4b4b' : '#25D366';
            ctx.lineWidth = 5;
            penguin.trail.forEach((p, i) => {
                if (i === 0) ctx.moveTo(p.x - cameraX, p.y);
                else ctx.lineTo(p.x - cameraX, p.y);
            });
            ctx.stroke();
        }

        // Pumbaa
        if (penguin.x < 600) {
            ctx.font = '100px serif';
            ctx.fillText('ğŸ—', 20 - cameraX, height - GROUND_Y + 10);
        }

        // Penguin
        ctx.save();
        ctx.translate(penguin.x - cameraX, penguin.y);
        ctx.rotate(penguin.rot);
        ctx.font = '50px serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(penguin.isSlamming ? 'ğŸ”¥' : 'ğŸ§', 0, 0);
        ctx.restore();

        ctx.restore();
    }

    function showGameOver() {
        const finalDist = Math.floor(penguin.x / 10);
        document.getElementById('final-score').innerText = `×”×’×¢×ª ×œ××¨×—×§ ×©×œ ${finalDist} ××˜×¨×™×!`;
        document.getElementById('game-over').style.display = 'flex';
        if (finalDist > highScore) {
            highScore = finalDist;
            localStorage.setItem('pumbaaHitBest', highScore);
            document.getElementById('best-ui').innerText = highScore;
        }
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    window.addEventListener('mousedown', handleInput);
    window.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(); }, {passive: false});
    window.addEventListener('resize', resize);

    resize();
    resetGame();
    gameLoop();
</script>
</body>
</html>
