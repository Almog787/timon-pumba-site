<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©Verse Ultimate Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --accent: #fbbf24; /* Amber 400 */
            --accent-glow: rgba(251, 191, 36, 0.5);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --success: #22c55e;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Rubik', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            background-image: 
                radial-gradient(at 0% 0%, rgba(56, 189, 248, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(251, 191, 36, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        /* --- UI COMPONENTS --- */
        
        /* 1. Navbar */
        .navbar {
            position: sticky; top: 20px; z-index: 1000;
            width: 90%; max-width: 1200px; margin: 0 auto;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 100px;
            padding: 10px 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .brand {
            font-size: 1.5rem; font-weight: 900;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .nav-links { display: flex; gap: 5px; }

        .nav-item {
            padding: 10px 20px; cursor: pointer; border-radius: 30px;
            font-weight: 600; color: var(--text-muted); transition: 0.3s;
            font-size: 0.95rem;
        }
        .nav-item:hover { color: white; background: rgba(255,255,255,0.05); }
        .nav-item.active {
            background: var(--accent); color: #0f172a;
            box-shadow: 0 0 15px var(--accent-glow);
        }

        /* 2. Sections Transition */
        .section {
            display: none; opacity: 0; transform: translateY(20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
            max-width: 1200px; margin: 40px auto; padding: 0 20px;
        }
        .section.active { display: block; opacity: 1; transform: translateY(0); }

        /* 3. Controls Bar (Filters) */
        .controls-bar {
            display: flex; gap: 15px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap;
        }
        .filter-btn {
            background: var(--bg-card); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-main); padding: 8px 16px; border-radius: 12px;
            cursor: pointer; transition: 0.2s;
        }
        .filter-btn:hover, .filter-btn.active { border-color: var(--accent); color: var(--accent); }

        /* --- POKEDEX --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        
        .card {
            background: var(--bg-card); border-radius: 20px; padding: 20px;
            position: relative; overflow: hidden; cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-direction: column; align-items: center;
        }
        .card:hover { transform: translateY(-8px); box-shadow: 0 10px 40px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.2); }
        
        /* Type Gradients */
        .bg-fire { background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(30,41,59,1)); }
        .bg-water { background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(30,41,59,1)); }
        .bg-grass { background: linear-gradient(135deg, rgba(34,197,94,0.2), rgba(30,41,59,1)); }
        .bg-electric { background: linear-gradient(135deg, rgba(234,179,8,0.2), rgba(30,41,59,1)); }
        .bg-psychic { background: linear-gradient(135deg, rgba(236,72,153,0.2), rgba(30,41,59,1)); }
        .bg-ghost { background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(30,41,59,1)); }
        /* Fallback for others */
        .bg-normal { background: linear-gradient(135deg, rgba(148,163,184,0.2), rgba(30,41,59,1)); }

        .card-img { width: 140px; height: 140px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5)); transition: 0.3s; z-index: 2; }
        .card:hover .card-img { transform: scale(1.15); }

        .card-id { position: absolute; top: 15px; right: 15px; font-weight: bold; color: rgba(255,255,255,0.2); font-size: 1.5rem; }
        .card-name { font-size: 1.2rem; font-weight: 700; text-transform: capitalize; margin-top: 15px; z-index: 2; }
        
        .type-tag { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; background: rgba(255,255,255,0.1); margin-top: 5px; text-transform: capitalize; }

        /* --- BATTLE ARENA --- */
        .battle-container {
            display: flex; flex-direction: column; gap: 20px;
        }
        
        .arena-stage {
            background: #111; border-radius: 24px; height: 400px;
            position: relative; overflow: hidden;
            background-image: radial-gradient(circle at 50% 120%, #222 0%, #000 70%);
            border: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center; padding: 0 10%;
        }

        .battler { text-align: center; width: 200px; position: relative; }
        .battler img { width: 180px; filter: drop-shadow(0 15px 15px rgba(0,0,0,0.8)); transition: 0.2s; }
        
        /* Animations */
        .anim-attack { animation: lunge 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.27); }
        .anim-hit { animation: shake 0.4s; filter: brightness(3) sepia(1) hue-rotate(-50deg) saturate(5); }
        .anim-faint { transition: 1s; opacity: 0; transform: translateY(50px) grayscale(1); }
        
        @keyframes lunge { 50% { transform: scale(1.4) translateY(-30px); } }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }

        .hp-bar-wrapper { width: 100%; height: 8px; background: #333; border-radius: 4px; margin-top: 15px; overflow: hidden; }
        .hp-fill { height: 100%; background: var(--success); width: 100%; transition: width 0.5s ease-out, background 0.3s; }

        .battle-log-box {
            height: 150px; background: rgba(0,0,0,0.3); border-radius: 16px;
            padding: 20px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1);
            font-family: monospace; font-size: 0.9rem;
        }
        .log-line { margin-bottom: 6px; padding-bottom: 6px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .log-super { color: var(--success); }
        .log-weak { color: var(--text-muted); }
        .log-crit { color: var(--accent); font-weight: bold; }

        .dmg-float {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            font-size: 2rem; font-weight: 900; color: var(--danger);
            animation: floatUp 1s forwards; pointer-events: none;
            text-shadow: 0 0 10px black;
        }
        @keyframes floatUp { to { top: -50px; opacity: 0; } }

        /* --- TCG --- */
        .tcg-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 30px; perspective: 1000px; }
        .tcg-card {
            width: 100%; border-radius: 14px; cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.6);
            transition: transform 0.1s;
        }

        /* --- MINI GAME --- */
        .game-wrapper {
            background: var(--bg-card); border-radius: 30px; padding: 40px;
            text-align: center; max-width: 600px; margin: 0 auto;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative; overflow: hidden;
        }
        .streak-badge {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; color: var(--accent);
        }
        
        .shadow-img { width: 220px; filter: brightness(0); transition: filter 0.5s; pointer-events: none; }
        .shadow-img.revealed { filter: brightness(1) drop-shadow(0 0 30px var(--accent-glow)); }

        .game-input {
            width: 70%; padding: 15px; border-radius: 12px; border: 2px solid #333;
            background: #0f172a; color: white; font-size: 1.2rem; text-align: center;
            margin: 20px 0; outline: none; transition: 0.3s;
        }
        .game-input:focus { border-color: var(--accent); }

        .action-btn {
            background: var(--accent); color: black; border: none; padding: 12px 30px;
            border-radius: 50px; font-weight: 800; cursor: pointer; transition: 0.2s;
            font-size: 1rem;
        }
        .action-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--accent-glow); }

        /* --- INFO MODAL --- */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 2000; display: none; justify-content: center; align-items: center;
        }
        .modal-overlay.active { display: flex; animation: fadeModal 0.3s; }
        @keyframes fadeModal { from { opacity: 0; } to { opacity: 1; } }

        .modal-card {
            background: #1e293b; width: 90%; max-width: 500px; border-radius: 24px;
            padding: 30px; position: relative; border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        .modal-img-circle {
            width: 150px; height: 150px; margin: -80px auto 20px;
            background: radial-gradient(circle, rgba(255,255,255,0.1), transparent);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .stat-bar { display: flex; align-items: center; gap: 10px; margin: 8px 0; font-size: 0.9rem; }
        .stat-label { width: 60px; text-align: left; color: var(--text-muted); font-weight: bold; font-size: 0.75rem; text-transform: uppercase; }
        .progress-bg { flex: 1; height: 6px; background: #333; border-radius: 3px; }
        .progress-fill { height: 100%; background: var(--accent); border-radius: 3px; }

        /* Mobile */
        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 15px; border-radius: 20px; padding: 15px; width: 95%; }
            .nav-links { flex-wrap: wrap; justify-content: center; }
            .arena-stage { flex-direction: column; height: auto; padding: 40px 0; gap: 40px; }
            .battler img { width: 140px; }
        }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="brand">Pok√©Verse</div>
        <div class="nav-links">
            <div class="nav-item active" onclick="app.navigate('pokedex')">Pok√©dex</div>
            <div class="nav-item" onclick="app.navigate('battle')">Battle Arena</div>
            <div class="nav-item" onclick="app.navigate('tcg')">TCG Gallery</div>
            <div class="nav-item" onclick="app.navigate('game')">Minigame</div>
        </div>
    </nav>

    <!-- SECTION 1: POKEDEX -->
    <section id="pokedex" class="section active">
        <div class="controls-bar">
            <button class="filter-btn active" onclick="pokedex.setGen(1)">Gen 1</button>
            <button class="filter-btn" onclick="pokedex.setGen(2)">Gen 2</button>
            <button class="filter-btn" onclick="pokedex.setGen(3)">Gen 3</button>
            <input type="text" id="dex-search" placeholder="Search Pok√©mon..." 
                   style="background:transparent; border:1px solid #444; color:white; padding:8px 15px; border-radius:12px; outline:none;"
                   onkeyup="pokedex.search(this.value)">
        </div>
        <div class="grid" id="pokedex-grid">
            <!-- JS Injection -->
        </div>
    </section>

    <!-- SECTION 2: BATTLE ARENA -->
    <section id="battle" class="section">
        <div class="battle-container">
            <div class="arena-stage">
                <div class="battler" id="p1">
                    <div class="dmg-float" id="dmg-p1"></div>
                    <img id="p1-img" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png">
                    <div style="margin-top:10px;">
                        <h3 id="p1-name">Charizard</h3>
                        <div class="hp-bar-wrapper"><div class="hp-fill" id="p1-hp"></div></div>
                    </div>
                </div>
                
                <div style="text-align:center;">
                    <h1 style="font-size:3rem; font-style:italic; color:rgba(255,255,255,0.1);">VS</h1>
                </div>

                <div class="battler" id="p2">
                    <div class="dmg-float" id="dmg-p2"></div>
                    <img id="p2-img" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png">
                    <div style="margin-top:10px;">
                        <h3 id="p2-name">Blastoise</h3>
                        <div class="hp-bar-wrapper"><div class="hp-fill" id="p2-hp"></div></div>
                    </div>
                </div>
            </div>

            <div style="display:flex; gap:20px;">
                <button class="action-btn" onclick="battle.start()" style="flex:1">FIGHT!</button>
                <button class="action-btn" onclick="battle.randomize()" style="flex:1; background:#333; color:white;">Randomize</button>
            </div>

            <div class="battle-log-box" id="battle-log">
                <div>Welcome to the Arena. Press FIGHT to begin!</div>
            </div>
        </div>
    </section>

    <!-- SECTION 3: TCG GALLERY -->
    <section id="tcg" class="section">
        <div style="text-align:center; margin-bottom:30px;">
            <h2>Rare Holo Cards</h2>
            <p style="color:var(--text-muted)">Interactive 3D Tilt Effect</p>
        </div>
        <div class="tcg-grid" id="tcg-grid">
            <!-- JS Injection -->
        </div>
    </section>

    <!-- SECTION 4: MINI GAME -->
    <section id="game" class="section">
        <div class="game-wrapper">
            <div class="streak-badge">Streak: <span id="streak-count">0</span></div>
            <h2>Who's that Pok√©mon?</h2>
            
            <div style="height:250px; display:flex; justify-content:center; align-items:center;">
                <img id="game-img" class="shadow-img" src="" alt="Mystery Pokemon">
            </div>

            <input type="text" class="game-input" id="game-guess" placeholder="Type name here...">
            <br>
            <button class="action-btn" onclick="game.check()">Submit Guess</button>
            <button class="action-btn" onclick="game.init()" style="background:transparent; border:1px solid #444; color:#aaa; margin-right:10px;">Skip</button>
            
            <p id="game-msg" style="margin-top:15px; font-weight:bold; min-height:20px;"></p>
        </div>
    </section>

    <!-- MODAL -->
    <div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this) modal.close()">
        <div class="modal-card" id="modal-content">
            <!-- Dynamic Content -->
        </div>
    </div>

    <script>
        // --- 1. APP CORE ---
        const app = {
            currentTab: 'pokedex',
            navigate: (tabId) => {
                // Update UI classes
                document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                // Find index based on simple list logic
                const tabs = ['pokedex', 'battle', 'tcg', 'game'];
                document.querySelectorAll('.nav-item')[tabs.indexOf(tabId)].classList.add('active');

                // Init section specific logic
                if (tabId === 'pokedex' && pokedex.data.length === 0) pokedex.load();
                if (tabId === 'tcg' && document.getElementById('tcg-grid').children.length === 0) tcg.load();
                if (tabId === 'game' && !game.currentMon) game.init();
                if (tabId === 'battle' && !battle.p1) battle.randomize();
            }
        };

        // --- 2. POKEDEX MODULE ---
        const pokedex = {
            data: [],
            genOffset: 1,
            genLimit: 151, // Gen 1 default
            
            setGen: (gen) => {
                const gens = { 1: [1, 151], 2: [152, 100], 3: [252, 135] };
                pokedex.genOffset = gens[gen][0];
                pokedex.genLimit = gens[gen][1];
                
                // Update buttons visual
                document.querySelectorAll('.filter-btn').forEach((b, i) => {
                    b.classList.toggle('active', i + 1 === gen);
                });
                
                pokedex.load(true);
            },

            load: async (reset = false) => {
                const grid = document.getElementById('pokedex-grid');
                if (reset) grid.innerHTML = '<div style="grid-column:1/-1; text-align:center;">Loading Generation...</div>';
                
                const promises = [];
                for (let i = pokedex.genOffset; i < pokedex.genOffset + pokedex.genLimit; i++) {
                    promises.push(fetch(`https://pokeapi.co/api/v2/pokemon/${i}`).then(r => r.json()));
                }
                
                pokedex.data = await Promise.all(promises);
                pokedex.render(pokedex.data);
            },

            render: (list) => {
                const grid = document.getElementById('pokedex-grid');
                grid.innerHTML = '';
                list.forEach(p => {
                    const type = p.types[0].type.name;
                    const card = document.createElement('div');
                    card.className = `card bg-${type}`;
                    card.innerHTML = `
                        <div class="card-id">#${p.id}</div>
                        <img src="${p.sprites.other['official-artwork'].front_default}" class="card-img" loading="lazy">
                        <div class="card-name">${p.name}</div>
                        <div class="type-tag">${type}</div>
                    `;
                    card.onclick = () => modal.open(p);
                    grid.appendChild(card);
                });
            },

            search: (query) => {
                const filtered = pokedex.data.filter(p => p.name.toLowerCase().includes(query.toLowerCase()));
                pokedex.render(filtered);
            }
        };

        // --- 3. BATTLE MODULE (With Logic) ---
        const battle = {
            p1: null, p2: null,
            typeChart: {
                fire: { grass: 2, water: 0.5, ice: 2 },
                water: { fire: 2, grass: 0.5, ground: 2 },
                grass: { water: 2, fire: 0.5, ground: 2 },
                electric: { water: 2, ground: 0 },
                // Simplified for brevity
            },

            randomize: async () => {
                const id1 = Math.floor(Math.random() * 386) + 1;
                const id2 = Math.floor(Math.random() * 386) + 1;
                
                const [d1, d2] = await Promise.all([
                    fetch(`https://pokeapi.co/api/v2/pokemon/${id1}`).then(r=>r.json()),
                    fetch(`https://pokeapi.co/api/v2/pokemon/${id2}`).then(r=>r.json())
                ]);

                battle.p1 = battle.setupStats(d1);
                battle.p2 = battle.setupStats(d2);
                battle.updateUI();
                battle.log("New challengers entered the arena!");
            },

            setupStats: (data) => ({
                name: data.name,
                img: data.sprites.other['official-artwork'].front_default,
                type: data.types[0].type.name,
                maxHp: data.stats[0].base_stat * 3,
                hp: data.stats[0].base_stat * 3,
                atk: data.stats[1].base_stat
            }),

            updateUI: () => {
                ['p1', 'p2'].forEach(p => {
                    const data = battle[p];
                    document.getElementById(`${p}-name`).innerText = data.name;
                    document.getElementById(`${p}-img`).src = data.img;
                    const pct = (data.hp / data.maxHp) * 100;
                    const bar = document.getElementById(`${p}-hp`);
                    bar.style.width = pct + '%';
                    bar.style.backgroundColor = pct < 25 ? '#ef4444' : pct < 50 ? '#fbbf24' : '#22c55e';
                });
            },

            start: async () => {
                if(battle.p1.hp <= 0 || battle.p2.hp <= 0) return battle.randomize();
                
                // Turn based simulation
                let active = true;
                while(active) {
                    // P1 Attacks
                    if(!await battle.turn(battle.p1, battle.p2, 'p1', 'p2')) { active = false; break; }
                    // P2 Attacks
                    if(!await battle.turn(battle.p2, battle.p1, 'p2', 'p1')) { active = false; break; }
                }
            },

            turn: async (atk, def, atkId, defId) => {
                // Animation
                document.getElementById(atkId).classList.add('anim-attack');
                setTimeout(()=>document.getElementById(atkId).classList.remove('anim-attack'), 300);
                
                await new Promise(r => setTimeout(r, 400)); // Wait for impact

                // Calc Damage
                let multiplier = 1;
                if (battle.typeChart[atk.type] && battle.typeChart[atk.type][def.type]) {
                    multiplier = battle.typeChart[atk.type][def.type];
                }
                
                const isCrit = Math.random() < 0.1;
                let damage = Math.floor((atk.atk * 0.5) * multiplier * (isCrit ? 1.5 : 1)) + 5;
                def.hp = Math.max(0, def.hp - damage);

                // Hit Animation
                const defEl = document.getElementById(defId);
                defEl.classList.add('anim-hit');
                setTimeout(()=>defEl.classList.remove('anim-hit'), 400);

                // Floating Text
                const float = document.getElementById(`dmg-${defId}`);
                float.innerText = `-${damage}`;
                float.style.animation = 'none';
                float.offsetHeight; /* trigger reflow */
                float.style.animation = 'floatUp 1s forwards';

                // Log
                let extra = "";
                if(multiplier > 1) extra = " <span class='log-super'>It's super effective!</span>";
                if(multiplier < 1 && multiplier > 0) extra = " <span class='log-weak'>Not very effective...</span>";
                if(isCrit) extra += " <span class='log-crit'>Critical Hit!</span>";
                
                battle.log(`${atk.name} hits for ${damage}!${extra}`);
                battle.updateUI();

                if (def.hp <= 0) {
                    document.getElementById(defId).classList.add('anim-faint');
                    battle.log(`<strong>${atk.name} WINS!</strong>`);
                    return false; // Battle over
                }

                await new Promise(r => setTimeout(r, 1000)); // Pace
                return true; // Continue
            },

            log: (msg) => {
                const box = document.getElementById('battle-log');
                const line = document.createElement('div');
                line.className = 'log-line';
                line.innerHTML = `> ${msg}`;
                box.prepend(line);
            }
        };

        // --- 4. TCG MODULE (Interactive 3D) ---
        const tcg = {
            load: async () => {
                const grid = document.getElementById('tcg-grid');
                grid.innerHTML = 'Loading Holo Cards...';
                
                const res = await fetch('https://api.pokemontcg.io/v2/cards?q=rarity:Rare&pageSize=12');
                const data = await res.json();
                
                grid.innerHTML = '';
                data.data.forEach(card => {
                    const el = document.createElement('div');
                    el.style.perspective = '1000px';
                    el.innerHTML = `<img src="${card.images.large}" class="tcg-card">`;
                    
                    const img = el.querySelector('img');
                    // Tilt Logic
                    img.onmousemove = (e) => {
                        const box = img.getBoundingClientRect();
                        const x = (e.clientX - box.left) / box.width - 0.5;
                        const y = (e.clientY - box.top) / box.height - 0.5;
                        img.style.transform = `rotateY(${x * 20}deg) rotateX(${-y * 20}deg) scale(1.1)`;
                    };
                    img.onmouseleave = () => img.style.transform = 'rotateY(0) rotateX(0) scale(1)';
                    
                    grid.appendChild(el);
                });
            }
        };

        // --- 5. GAME MODULE ---
        const game = {
            currentMon: null,
            streak: 0,

            init: async () => {
                const id = Math.floor(Math.random() * 151) + 1;
                const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
                game.currentMon = await res.json();
                
                const img = document.getElementById('game-img');
                img.src = game.currentMon.sprites.other['official-artwork'].front_default;
                img.className = 'shadow-img'; // Reset shadow
                
                document.getElementById('game-msg').innerText = '';
                document.getElementById('game-guess').value = '';
                document.getElementById('game-guess').focus();
            },

            check: () => {
                const guess = document.getElementById('game-guess').value.trim().toLowerCase();
                const name = game.currentMon.name;
                const msg = document.getElementById('game-msg');

                if (guess === name) {
                    document.getElementById('game-img').classList.add('revealed');
                    game.streak++;
                    msg.innerHTML = `<span style="color:var(--success)">Correct! It's ${name}!</span>`;
                    document.getElementById('streak-count').innerText = game.streak;
                    setTimeout(game.init, 2500);
                } else {
                    game.streak = 0;
                    document.getElementById('streak-count').innerText = 0;
                    msg.innerHTML = `<span style="color:var(--danger)">Wrong! It was ${name}. streak reset.</span>`;
                    document.getElementById('game-img').classList.add('revealed');
                    setTimeout(game.init, 3000);
                }
            }
        };

        // --- 6. MODAL UTILS ---
        const modal = {
            open: (p) => {
                const overlay = document.getElementById('modal-overlay');
                const content = document.getElementById('modal-content');
                
                // Get Cry URL
                const cry = p.cries.latest || p.cries.legacy;

                content.innerHTML = `
                    <div class="modal-img-circle">
                        <img src="${p.sprites.other['official-artwork'].front_default}" width="140">
                    </div>
                    <h2 style="text-transform:capitalize; font-size:2rem; margin-bottom:5px;">${p.name}</h2>
                    <div class="type-tag" style="display:inline-block; margin-bottom:20px;">${p.types[0].type.name}</div>
                    
                    <div style="text-align:left;">
                        ${p.stats.map(s => `
                            <div class="stat-bar">
                                <div class="stat-label">${s.stat.name}</div>
                                <div class="progress-bg">
                                    <div class="progress-fill" style="width:${Math.min(s.base_stat, 100)}%"></div>
                                </div>
                                <div style="font-weight:bold; font-size:0.8rem; width:30px; text-align:right;">${s.base_stat}</div>
                            </div>
                        `).join('')}
                    </div>

                    <button class="action-btn" onclick="new Audio('${cry}').play()" style="margin-top:20px; width:100%;">
                        üîä Play Cry
                    </button>
                    <div style="margin-top:10px; cursor:pointer; color:#aaa; font-size:0.8rem;" onclick="modal.close()">Close</div>
                `;
                
                overlay.classList.add('active');
            },
            close: () => {
                document.getElementById('modal-overlay').classList.remove('active');
            }
        };

        // --- INIT ---
        window.onload = () => {
            pokedex.load(); // Initial Load
            
            // Allow Enter key in game
            document.getElementById('game-guess').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') game.check();
            });
        };

    </script>
</body>
</html>
